- job:
    name: checkbox.io
    project-type: pipeline
    dsl: |
        node {
            stage('Source') {
                git 'https://github.com/chrisparnin/checkbox.io.git'
            }
            stage('Analysis') {
                dir("server-side") {
                    sh 'node /bakerx/analysis.js $(pwd)'
                }
            }
            stage('Build') {
                dir("server-side/site") {
                    sh 'pwd'
                    sh 'npm cache clean'
                    sh 'npm install' 
                }
            }
            stage('Start server and test') {
                dir("server-side/site") {
                    sh 'node server.js &'
                    sh "npm test"
                }
            }
        }