---
# see the best practices in ansible docs for how to get started with creating roles etc.:
# https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html

- hosts: localhost
  tasks:
    - name: Add nodejs source
      shell: curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -

    - name: Install dependencies
      apt:
        name: [unzip, nodejs, redis-server]
        update_cache: yes
      become: yes
  
    - name: Create dashboard folder
      file:
        path: /dashboard
        state: directory
        mode: '0755'

    - name: Unzip dashboard
      unarchive:
        src: /root/monitoring_tools/dashboard.zip
        dest: /dashboard

    - name: Install forever
      npm:
        name: forever
        global: yes
        state: present
        
    - name: Forever run the dashboard
      shell: cd /dashboard && npm install && forever stopall && forever start bin/www

